需求说明：对话与提示词构建的新要求

用户输入场景多元化

纯聊天：用户可能不在编辑器、无选区、无上下文，仅想与 AI 对话，可附带“参考文件”作为补充语料。
基于选中内容问答：选中文本只是“参考材料”或问题背景，不一定是“要改写/续写”。
光标在编辑器但无选区：同样可能只是提问，不是续写；上下文可选用、不应强制使用续写提示。
选中文字做编辑：用户明确想改写/润色/重写选区。
基于上下文插入：光标所在处附近的上下文可作为生成依据，用于插入新内容。
提示词构建目标

不再默认假设“续写”；根据用户意图动态组装。
明确区分：
“编辑模式”（有选区且意图改写）。
“问答/创作模式”（无选区或选区仅作参考）。
“上下文插入模式”（光标上下文可作为参考，但不必强制续写）。
参考资料（手动选取的知识检索结果）应被单独标记为“参考文档”，但不强制视为编辑上下文。
可用信号与决策

选区是否存在。
用户是否显式选择“编辑/改写”意图（需 UI 或参数传递）。
是否有可用的光标上下文（before/afterText），但不要自动要求续写。
是否附加了手动选择的参考文档（additionalContext/contextContent）。
用户自填的指令/问题（prompt）。
提示词建议结构（待实现）

角色/系统提示：保持全局规则。
用户目的：基于当前模式（编辑 / 问答 / 插入）声明意图。
提供的材料：
选中文本（标明用途：待改写 或 参考材料）。
光标上下文（若存在且用户同意使用）。
参考文档（知识检索勾选的内容）。
用户指令/问题：原始 prompt。
约束：基于参考文档回答；如为编辑模式，要求保持原文风格/结构等。
边界/行为要求

无上下文/无选区/无参考时，允许直接聊天，不报错。
参考文档存在时，强调优先使用，但避免与“待改写内容”混淆。
当意图为编辑时，明确“只修改选中文本”或“基于选中文本重写”。
当意图为插入时，说明生成内容用于光标处插入，可参考上下文，不要求复述上下文。
当意图为问答时，避免续写措辞，转为“请回答/生成”。
后续实现要点

增加意图标识（UI 或参数）：mode = edit | qa | insert | chat | continue 等。
提示词生成逻辑按模式分支，避免硬编码续写文案。
参考文档与选中文本、上下文分栏注入，使用不同提示标签。
保留现有全局规则与模型选择逻辑。
