# 历史记录功能废弃验证测试用例

本文档用于验证 Markdown-Next-AI 插件中历史记录功能（History Record）是否已完全移除，并确保相关核心功能未受影响。

## 1. 代码静态检查验证

### 1.1 关键词搜索
**目标**: 确保代码库中不再包含任何历史记录相关的变量、接口或方法。

**测试步骤**:
1. 在 `src` 目录下执行全局搜索（grep）。
2. 搜索关键词：`conversationHistory`, `ConversationEntry`, `recordConversation`, `markdown-next-ai-history-btn`.

**预期结果**:
- `conversationHistory`: 无匹配（除 git 历史外）。
- `ConversationEntry`: 无匹配。
- `recordConversation`: 无匹配。
- `markdown-next-ai-history-btn`: 无匹配。

### 1.2 类型定义检查
**目标**: 确保 `src/types.ts` 中不再包含历史记录相关的类型定义。

**测试步骤**:
1. 打开 `src/types.ts`。
2. 检查 `PluginSettings` 接口。

**预期结果**:
- `PluginSettings` 中不包含 `conversationHistory` 或 `conversationHistoryLimit` 字段。
- 文件中不存在 `ConversationEntry` 接口定义。

### 1.3 默认配置检查
**目标**: 确保 `src/defaults.ts` 中不再包含历史记录的默认值。

**测试步骤**:
1. 打开 `src/defaults.ts`。
2. 检查 `DEFAULT_SETTINGS` 对象。

**预期结果**:
- `DEFAULT_SETTINGS` 中不包含 `conversationHistory` 字段。

---

## 2. 运行时功能验证

由于无法在当前环境运行 Obsidian，以下测试用例需在实际环境中执行。

### 2.1 插件加载测试
**目标**: 确保插件在移除历史记录功能后仍能正常加载。

**测试步骤**:
1. 启动 Obsidian。
2. 启用 Markdown-Next-AI 插件。
3. 打开控制台（Ctrl+Shift+I）。

**预期结果**:
- 插件成功加载。
- 控制台无报错信息（特别是关于 `undefined` settings 的错误）。

### 2.2 设置页面测试
**目标**: 确保设置页面不再显示历史记录相关选项，且其他设置正常工作。

**测试步骤**:
1. 打开插件设置页面。
2. 浏览所有设置项。

**预期结果**:
- 找不到 "Clear History"（清除历史）或 "History Limit"（历史记录限制）等选项。
- "API设置"、"模型设置"、"通用设置" 等其他选项显示正常且可交互。

### 2.3 UI 界面测试 (AtTriggerPopup)
**目标**: 确保对话弹窗中不再显示历史记录按钮。

**测试步骤**:
1. 在编辑器中输入 `@` 或使用快捷键唤出 AI 对话框。
2. 观察弹窗右上角或底部工具栏。

**预期结果**:
- 界面整洁，只有 "模型选择"、"设置"（如有）、"发送" 等核心按钮。
- **不存在** 时钟图标或历史记录入口按钮。
- 鼠标悬停在各按钮上，无残留的 tooltip 显示 "历史记录"。

### 2.4 核心对话功能测试
**目标**: 确保移除历史记录逻辑后，正常的 AI 对话不受影响。

**测试步骤**:
1. 唤出 AI 对话框。
2. 输入一段测试文本（如 "Hello"）。
3. 发送请求。

**预期结果**:
- AI 能够正常响应并流式输出。
- 对话结束后，内容正常显示在弹窗中（Chat模式）或文档中（Text模式）。
- 控制台无报错（检查是否有调用已删除的 `recordConversation` 方法导致的报错）。

### 2.5 数据持久化测试
**目标**: 确保插件不再向 `data.json` 写入历史记录数据。

**测试步骤**:
1. 进行几次 AI 对话。
2. 关闭 Obsidian。
3. 查看插件目录下的 `data.json` 文件。

**预期结果**:
- `data.json` 文件中不包含 `conversationHistory` 字段。
- 文件大小未因对话次数增加而显著增长。

---

## 3. 回归测试

### 3.1 上下文引用
**测试步骤**: 使用 `@` 引用文件并提问。
**预期结果**: AI 能正确读取引用内容并回答，不受历史记录移除影响。

### 3.2 图片上传
**测试步骤**: 粘贴图片并提问。
**预期结果**: 多模态功能正常工作。

### 3.3 快捷指令
**测试步骤**: 使用 `#` 调用提示词。
**预期结果**: 提示词列表正常显示并可调用。
